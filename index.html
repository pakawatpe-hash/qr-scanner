<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner - Mobile to PC</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        :root {
            --primary: #00ff88;
            --primary-dark: #00cc6a;
            --bg-dark: #0a0e1a;
            --bg-darker: #050810;
            --text-light: #e8f0ff;
            --text-muted: #7a8ba8;
            --accent: #ff6b9d;
            --border: rgba(0, 255, 136, 0.2);
            --glow: rgba(0, 255, 136, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 107, 157, 0.08) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 20px var(--glow));
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.8rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            font-weight: 300;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mode-btn {
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Lexend', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-light);
            position: relative;
            overflow: hidden;
        }

        .mode-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: var(--glow);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .mode-btn:hover {
            border-color: var(--primary);
            background: rgba(0, 255, 136, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
        }

        .mode-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 255, 136, 0.05));
            border-color: var(--primary);
            box-shadow: 0 0 30px var(--glow);
        }

        .mode-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 10px;
        }

        .section {
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(0, 255, 136, 0.4);
            box-shadow: 0 8px 32px rgba(0, 255, 136, 0.15);
        }

        .pairing-code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            letter-spacing: 8px;
            color: var(--primary);
            text-shadow: 0 0 20px var(--glow);
            margin: 20px 0;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px var(--glow); }
            50% { text-shadow: 0 0 30px var(--glow), 0 0 40px var(--glow); }
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-light);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            text-align: center;
            letter-spacing: 6px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(0, 255, 136, 0.05);
            box-shadow: 0 0 20px var(--glow);
        }

        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 12px;
            color: var(--bg-dark);
            font-family: 'Lexend', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            color: var(--text-muted);
        }

        .status {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
            animation: fadeIn 0.5s ease-out;
        }

        .status.connected {
            background: rgba(0, 255, 136, 0.15);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .status.waiting {
            background: rgba(255, 183, 77, 0.15);
            color: #ffb74d;
            border: 1px solid rgba(255, 183, 77, 0.3);
        }

        .status.error {
            background: rgba(255, 107, 157, 0.15);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        #qr-reader {
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--border);
            margin: 20px 0;
        }

        #qr-reader video {
            border-radius: 14px;
        }

        .scan-history {
            margin-top: 20px;
        }

        .scan-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--primary);
            animation: slideIn 0.3s ease-out;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            word-break: break-all;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .info-text {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin: 15px 0;
            line-height: 1.6;
        }

        .received-data {
            background: rgba(0, 255, 136, 0.1);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--primary);
            margin: 15px 0;
            font-family: 'JetBrains Mono', monospace;
            word-break: break-all;
            animation: highlight 0.5s ease-out;
        }

        @keyframes highlight {
            0% {
                background: rgba(0, 255, 136, 0.3);
                transform: scale(1.02);
            }
            100% {
                background: rgba(0, 255, 136, 0.1);
                transform: scale(1);
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .pairing-code {
                font-size: 2.5rem;
                letter-spacing: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üì±üíª</div>
            <h1>QR Scanner</h1>
            <p class="subtitle">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
        </div>

        <!-- Mode Selection -->
        <div id="modeSelection" class="mode-selector">
            <button class="mode-btn" onclick="selectMode('computer')">
                <span class="mode-icon">üíª</span>
                <div>‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</div>
            </button>
            <button class="mode-btn" onclick="selectMode('mobile')">
                <span class="mode-icon">üì±</span>
                <div>‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</div>
            </button>
        </div>

        <!-- Computer Mode -->
        <div id="computerSection" class="section">
            <div class="card">
                <h2 style="margin-bottom: 20px; text-align: center;">‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</h2>
                <p class="info-text">‡πÉ‡∏´‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
                <div id="computerCode" class="pairing-code">----</div>
                <div id="computerStatus" class="status waiting">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
                
                <div id="receivedDataSection" style="display: none;">
                    <h3 style="margin-top: 20px; margin-bottom: 10px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</h3>
                    <div id="receivedData" class="received-data"></div>
                    <button onclick="copyToClipboard()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>

        <!-- Mobile Mode -->
        <div id="mobileSection" class="section">
            <div class="card">
                <h2 style="margin-bottom: 20px; text-align: center;">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</h2>
                
                <div id="mobilePairing">
                    <div class="input-group">
                        <label>‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</label>
                        <input type="text" id="pairingCodeInput" maxlength="4" placeholder="----" style="text-transform: uppercase;">
                    </div>
                    <button onclick="connectToComputer()">üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
                </div>

                <div id="mobileScanner" style="display: none;">
                    <div id="mobileStatus" class="status connected">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
                    <div id="qr-reader"></div>
                    <button onclick="stopScanning()" style="background: linear-gradient(135deg, var(--accent), #ff4081);">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô</button>
                    
                    <div class="scan-history" id="scanHistory" style="display: none;">
                        <h3 style="margin-bottom: 10px;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô:</h3>
                        <div id="historyList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, remove, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD041vIYJDCS6rgVpN2gF74nnXJVQWvTGs",
            authDomain: "qr-scanner-5f457.firebaseapp.com",
            databaseURL: "https://qr-scanner-5f457-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "qr-scanner-5f457",
            storageBucket: "qr-scanner-5f457.firebasestorage.app",
            messagingSenderId: "304467409014",
            appId: "1:304467409014:web:85fbb2778511fe6dc38757"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global variables
        window.currentMode = null;
        window.pairingCode = null;
        window.isConnected = false;
        window.html5QrCode = null;
        window.sessionRef = null;

        // Generate random pairing code
        function generateCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // Select mode
        window.selectMode = function(mode) {
            window.currentMode = mode;
            document.getElementById('modeSelection').style.display = 'none';
            
            if (mode === 'computer') {
                document.getElementById('computerSection').classList.add('active');
                startComputerMode();
            } else {
                document.getElementById('mobileSection').classList.add('active');
            }
        };

        // Computer Mode
        async function startComputerMode() {
            window.pairingCode = generateCode();
            document.getElementById('computerCode').textContent = window.pairingCode;
            
            console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á session ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™:', window.pairingCode);
            
            // Create session in Firebase
            window.sessionRef = ref(database, 'sessions/' + window.pairingCode);
            
            try {
                await set(window.sessionRef, {
                    code: window.pairingCode,
                    timestamp: Date.now(),
                    data: null
                });
                
                console.log('‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á session ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                
                // Listen for data changes
                onValue(window.sessionRef, (snapshot) => {
                    const data = snapshot.val();
                    console.log('‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase:', data);
                    
                    if (data && data.data) {
                        document.getElementById('computerStatus').className = 'status connected';
                        document.getElementById('computerStatus').textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                        document.getElementById('receivedDataSection').style.display = 'block';
                        document.getElementById('receivedData').textContent = data.data;
                        
                        // Auto-copy to clipboard
                        navigator.clipboard.writeText(data.data).then(() => {
                            console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß:', data.data);
                        }).catch(err => {
                            console.error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ:', err);
                        });
                        
                        // Clear the data after reading
                        set(window.sessionRef, {
                            code: window.pairingCode,
                            timestamp: Date.now(),
                            data: null
                        });
                    }
                });
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á session:', error);
                document.getElementById('computerStatus').className = 'status error';
                document.getElementById('computerStatus').textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
            }
        }

        window.copyToClipboard = function() {
            const data = document.getElementById('receivedData').textContent;
            navigator.clipboard.writeText(data).then(() => {
                alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß! ‚úÖ');
            });
        };

        // Mobile Mode
        window.connectToComputer = async function() {
            const code = document.getElementById('pairingCodeInput').value.toUpperCase();
            
            if (code.length !== 4) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ 4 ‡∏ï‡∏±‡∏ß');
                return;
            }

            console.log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™:', code);

            window.pairingCode = code;
            window.sessionRef = ref(database, 'sessions/' + code);
            
            try {
                // Check if session exists
                const snapshot = await get(window.sessionRef);
                
                console.log('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö session:', snapshot.exists(), snapshot.val());
                
                if (!snapshot.exists()) {
                    alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                    console.error('Session not found for code:', code);
                    return;
                }
                
                console.log('‚úÖ ‡∏û‡∏ö session ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...');
                window.isConnected = true;
                document.getElementById('mobilePairing').style.display = 'none';
                document.getElementById('mobileScanner').style.display = 'block';
                startScanning();
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        };

        // QR Scanner
        function startScanning() {
            window.html5QrCode = new Html5Qrcode("qr-reader");
            
            window.html5QrCode.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                },
                (decodedText) => {
                    onScanSuccess(decodedText);
                },
                (errorMessage) => {
                    // Scan error, ignore
                }
            ).catch((err) => {
                console.error('Error starting scanner:', err);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á');
            });
        }

        function onScanSuccess(decodedText) {
            // Send data to computer via Firebase
            set(window.sessionRef, {
                code: window.pairingCode,
                timestamp: Date.now(),
                data: decodedText
            });

            // Add to history
            const historyDiv = document.getElementById('scanHistory');
            const historyList = document.getElementById('historyList');
            historyDiv.style.display = 'block';
            
            const item = document.createElement('div');
            item.className = 'scan-item';
            item.textContent = decodedText;
            historyList.insertBefore(item, historyList.firstChild);

            // Show feedback
            const statusEl = document.getElementById('mobileStatus');
            statusEl.className = 'status connected';
            statusEl.textContent = '‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß!';
            
            setTimeout(() => {
                statusEl.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            }, 2000);
        }

        window.stopScanning = function() {
            if (window.html5QrCode) {
                window.html5QrCode.stop().then(() => {
                    window.html5QrCode.clear();
                    document.getElementById('mobileScanner').style.display = 'none';
                    document.getElementById('mobilePairing').style.display = 'block';
                    document.getElementById('pairingCodeInput').value = '';
                    window.isConnected = false;
                }).catch((err) => {
                    console.error('Error stopping scanner:', err);
                });
            }
        };

        // Allow only uppercase input
        document.getElementById('pairingCodeInput')?.addEventListener('input', function(e) {
            this.value = this.value.toUpperCase();
        });
    </script>
</body>
</html>
